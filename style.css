:root{
  --bg:#0b0b0f;
  --text:#f7f7fb;
  --muted:#b6b6c6;
  --pink:#ffd4e8;
  --radius:18px;

  --red-dark:#8f0014;
  --red-mid:#c8001e;
  --red-bright:#ff2a45;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  height:100vh;
  background:radial-gradient(circle at center top,#1a1117,#0b0b0f 85%);
  font-family: system-ui, sans-serif;
  color:var(--text);
  text-align:center;
  overflow:hidden;
}

#page{
  position:relative;
  width:100%;
  height:100vh;
}

/* ===================== SCREENS ===================== */
.screen{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px 14px 60px;
  opacity:0;
  pointer-events:none;
  transform:translateY(8px) scale(.98);
  transition:opacity .35s ease, transform .35s ease;
}
.screen.active{
  opacity:1;
  pointer-events:auto;
  transform:translateY(0) scale(1);
}

/* ===================== SECURITY GATE ===================== */
.gate-card{
  width:100%;
  max-width:420px;
  padding:26px 22px;
  margin:0 auto;
  border-radius:22px;
  background:linear-gradient(180deg,#12121d,#090911 90%);
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 22px 55px rgba(0,0,0,.55);
  text-align:center;
}

.top-bar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:14px;
}

.tag{
  background:#ffffff10;
  padding:4px 10px;
  border-radius:10px;
  font-size:12px;
  letter-spacing:.05em;
  color:#eee;
}

.badge{
  display:flex;
  align-items:center;
  gap:6px;
  background:#00000030;
  padding:4px 10px;
  border-radius:10px;
  font-size:12px;
}

.badge-dot{
  width:8px;height:8px;
  border-radius:50%;
  background:#ff3355;
}

.img-box{
  width:100%;
  display:flex;
  justify-content:center;
  margin-bottom:12px;
}

.guard-img{
  width:48%;
  max-width:180px;
  margin-top:8px;
  user-select:none;
  -webkit-user-drag:none;
}

.gate-welcome{
  font-size:22px;
  font-weight:900;
  margin:4px 0 6px;
  text-transform:capitalize;
}

.gate-sub{
  margin-top:0;
  margin-bottom:16px;
  color:#ccccde;
  font-size:14px;
  line-height:1.4;
}

.gate-form{
  margin-top:10px;
  display:grid;
  gap:10px;
}

#codeInput{
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:var(--text);
  text-align:center;
  letter-spacing:.2em;
}

.gate-btn{ max-width:100%; }

.gate-msg{
  font-size:14px;
  color:#ff8ba0;
  min-height:18px;
  margin-top:6px;
}

.gate-hint{
  font-size:12px;
  color:#cfcfe0;
  opacity:.8;
  margin:0;
}

.footer-info{
  margin-top:18px;
  color:#9c9cb0;
  font-size:12px;
}

/* ===================== HBD ===================== */
.hero{
  width:100%;
  max-width:520px;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:22px;
}

.hero-title{
  font-family: "Playfair Display", "Georgia", serif;
  font-weight:900;
  font-size:clamp(32px, 8.5vw, 48px);
  letter-spacing:.06em;
  text-transform:uppercase;
  margin:0 0 50px;
  line-height:1.15;
}

/* ================= CAKE ================= */
.cake-wrap{
  display:flex;
  justify-content:center;
  align-items:center;
  margin:0;
}

.cake{
  position:relative;
  width:min(330px, 90vw);
  height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-end;
  padding-top:58px;
  filter: drop-shadow(0 18px 30px rgba(0,0,0,.45));
}

.cake::after{
  content:"";
  position:absolute;
  bottom:-18px;
  width:112%;
  height:40px;
  background:
    radial-gradient(ellipse at center,
      #ffffff 0%,
      #e9e9ef 50%,
      #cfcfda 100%);
  border-radius:999px;
  box-shadow:
    0 18px 35px rgba(0,0,0,.55),
    inset 0 6px 10px rgba(255,255,255,.8);
  z-index:-2;
}

.layer{
  width:100%;
  border-radius:22px;
  position:relative;
  overflow:hidden;
  z-index:2;
}

.layer-bottom{
  height:140px;
  background:
    radial-gradient(circle at 25% 15%, rgba(255,255,255,.25), transparent 45%),
    radial-gradient(circle at 75% 25%, rgba(255,255,255,.15), transparent 55%),
    linear-gradient(180deg, var(--red-bright) 0%, var(--red-mid) 55%, var(--red-dark) 100%);
  box-shadow:
    inset 0 10px 18px rgba(255,255,255,.18),
    inset 0 -18px 18px rgba(0,0,0,.18);
}

/* icing */
.layer-bottom::before{
  content:"";
  position:absolute;
  top:0; left:0; right:0;
  height:40px;
  background:
    linear-gradient(#ffffff 0 15px, transparent 15px),
    radial-gradient(circle at 5.2% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 18% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 31% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 44% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 57% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 70% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 83% 10px, #ffffff 0 20px, transparent 23px),
    radial-gradient(circle at 96% 10px, #ffffff 0 20px, transparent 23px);
  background-repeat:no-repeat;
}

/* logo */
.cake-logo{
  position:absolute;
  width:26%;
  max-width:90px;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  z-index:3;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,.35));
  pointer-events:none;
}

/* ================= CANDLE ================= */
.candle-area{
  position:absolute;
  top:18px;
  left:50%;
  transform:translateX(-50%);
  z-index:1;
}

.candle{
  position:relative;
  width:22px;
  height:70px;
  background:linear-gradient(#fff,#f0f0f0);
  border-radius:8px;
  box-shadow:0 6px 14px rgba(0,0,0,.28);
}

.candle::before{
  content:"";
  position:absolute; inset:0;
  background: repeating-linear-gradient(
    135deg,
    transparent 0 6px,
    rgba(255,120,170,.38) 6px 12px
  );
  border-radius:8px;
}

.wick{
  position:absolute;
  top:-9px;
  width:2px;height:10px;
  background:#1a1a1a;
  border-radius:2px;
  z-index:3;
}

.flame{
  position:absolute;
  top:-36px;
  width:20px;height:30px;
  background: radial-gradient(circle at 50% 60%,#fff,#ffe07a 50%,#ff7b00 80%);
  border-radius:50%;
  transform-origin:50% 100%;
  animation:flicker .14s infinite alternate;
  filter:drop-shadow(0 0 10px rgba(255,180,0,.9));
  transition:transform .06s linear, opacity .2s, height .2s, width .2s;
  z-index:4;
}

@keyframes flicker{
  from{ transform:rotate(-2deg) scale(1); }
  to{ transform: rotate(3deg) scale(1.05);}
}

.glow{
  position:absolute;
  top:-56px;
  width:42px;height:42px;
  background:radial-gradient(rgba(255,190,0,.7),transparent 60%);
  border-radius:50%;
  animation:pulse 1.2s infinite;
  z-index:3;
}

@keyframes pulse{
  0%,100%{opacity:.6;transform:scale(.9);}
  50%{opacity:1;transform:scale(1.1);}
}

.candle.blowing .flame{
  transform:
    translateY(var(--wind-y,0))
    scaleX(var(--wind-sx,1))
    scaleY(var(--wind-sy,1));
  animation:flickerHard .06s infinite alternate;
}

@keyframes flickerHard{
  from{filter:drop-shadow(0 0 14px rgba(255,180,0,1));}
  to{filter:drop-shadow(0 0 3px rgba(255,130,0,.6));}
}

.candle.off .flame,
.candle.off .glow{
  opacity:0;
  transform:translateY(12px) scale(.3);
  animation:none;
}

/* ================= WISH BOX ================= */
.wish-box{
  margin-top:40px;
  width:100%;
  max-width:300px;
  margin-inline:auto;
  display:grid;
  gap:8px;
  opacity:0;
  transform: translateY(20px);
  transition: opacity .8s ease, transform .8s ease;
  pointer-events: none; 
}

.wish-box.show{
  opacity:1;
  transform: translateY(0);
  pointer-events: auto;
}

.wish-label{
  font-size:14px;
  font-weight:700;
  color:var(--pink);
  text-shadow:0 0 8px rgba(255,182,216,.5);
}

#wishInput{
  height:80px;
  padding:10px;
  border-radius:10px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  color:var(--text);
  font-size:14px;
  resize:none;
}

.primary-btn{
  background:linear-gradient(180deg, #ff3b57 0%, #d40021 55%, #a50017 100%);
  border:none;
  color:white;
  font-weight:700;
  padding:10px 14px;
  font-size:14px;
  border-radius:10px;
  max-width:240px;
  width:100%;
  margin:0 auto;
  cursor:pointer;
  display:block;
  box-shadow:0 10px 20px rgba(220,0,40,.35);
}

.primary-btn:disabled{opacity:.5;cursor:not-allowed;}

.mic-status{
  font-size:13px;
  color:#c8ffe7;
  margin-top:6px;
}

/* ================= POPUPS ================= */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  animation:fadeIn .3s ease;
}

@keyframes fadeIn{
  from{opacity:0;}
  to{opacity:1;}
}

.popup-card{
  background: linear-gradient(180deg, #1a1a26, #12121a);
  padding:18px;
  max-width:330px;
  width:90%;
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(0,0,0,.45);
  text-align:center;
  border:1px solid rgba(255,255,255,.08);
  position: relative;
}

.meme{
  width:100%;
  border-radius:14px;
  margin-bottom:6px;
}

.popup-text{
  font-weight:700;
  font-size:20px;
  margin-bottom:14px;
}

.popup-text.big{font-size:22px;}

.popup-sub{
  color:var(--muted);
  font-size:14px;
  margin-bottom:16px;
}

/* ===== Blow Mode ===== */
.blow-mode .hero-title,
.blow-mode .wish-box{
  display:none !important;
}

.click-hint{
  display:none;
  font-size:13px;
  color:#ffffffbb;
  margin-top:10px;
  text-align:center;
  opacity:.9;
}

body.blow-mode .click-hint{
  display:block;
}

/* ===== Finish Popup ===== */
.finish-card{
  position: relative;
}

.finish-img-wrap{
  position: relative;
  width: 100%;
  max-width: 300px;
  margin: 0 auto 12px;

  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 16px;
}

.finish-main{
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: 100% left;
  display:block;
  border-radius: 16px;
  box-shadow: 0 10px 28px rgba(0,0,0,.55);
}

.finish-overlay{
  position:absolute;
  left: 10px;
  bottom: 0px;
  width: 55%;
  max-width: 200px;
  height:auto;

  opacity:0;
  transform: translateY(6px);
  filter: drop-shadow(0 12px 20px rgba(0,0,0,9));
  transition: opacity .8s ease, transform .8s ease;
}

.popup.show .finish-overlay{
  opacity:1;
  transform: translateY(0);
}